"use strict";define(["module","common/kernel/kernel","common/pointerevents/pointerevents","./lang"],(function(t,e,a,n){var i,l,r,s,o,d,c,h,u,v,f,g,p,y,m=document.createElement("div"),C=32,b=new MutationObserver((function(t){for(var e=0;e<t.length;e++)"attributes"===t[e].type&&("data-value"===t[e].attributeName||"data-options"===t[e].attributeName||"data-required"===t[e].attributeName?M(t[e].target):"data-placeholder"!==t[e].attributeName||t[e].target.dataset.value||(t[e].target.dataset.firstChild.data=t[e].target.dataset.placeholder||n.choose))})),k={init:function(t){t.addEventListener("click",q),M(t),b.observe(t,{attributes:!0,attributeFilter:["data-value","data-options","data-placeholder"]})},action:L};return m.innerHTML='<div class="title">--</div><div class="content"></div><div class="btns"><a class="clear">--</a><a class="ok">--</a></div>',d=m.querySelector(".title").firstChild,c=m.querySelector(".content"),h=m.querySelector(".ok"),u=m.querySelector(".clear"),e.appendCss(require.toUrl(t.id)),c.addEventListener("transitionend",(function(t){o.length<l?t.target.style.transition="":t.target.style.marginTop?t.target.remove():(t.target.style.transition="",this.lastChild.remove())})),h.addEventListener("click",(function(){e.closeDialog("ok")})),u.addEventListener("click",(function(){e.closeDialog("clear")})),a(c,(function(t){if(o.length>1)if("start"===t.type){if(!this.pointers.length)return t.domEvent.preventDefault(),o.length<l?y=c.firstChild.offsetTop:(p=f,y=0),v=t.y,!0}else if("move"===t.type){var e=t.y-v;o.length<l?c.firstChild.style.marginTop=Math.min(Math.max(0,y+e),C)+"px":((y=e%C)>0&&(y-=C),(p=(f-Math.floor(e/C))%o.length)<0&&(p+=o.length),c.innerHTML=O(p,y))}else o.length<l?((y=c.firstChild.offsetTop)%C&&(y=Math.round(y/C),E()),f=0===y?1:0):y?(E(),f=(p-1-Math.round(y/C)+o.length)%o.length):f=p})),k;function E(){c.firstChild.style.marginTop=-y>16?"-32px":"",c.firstChild.style.transition="margin-top 100ms ease-in-out"}function M(t){if(t.dataset.options){var e=JSON.parse(t.dataset.options);if(Array.isArray(e))e.indexOf(t.dataset.value)<0?t.dataset.required&&e.length?t.firstChild.data=t.dataset.value=e[0]:T(t):t.firstChild.data=t.dataset.value;else if(e.hasOwnProperty(t.dataset.value))t.firstChild.data=e[t.dataset.value];else{var a=Object.keys(e);t.dataset.required&&a.length?(t.dataset.value=a[0],t.firstChild.data=e[a[0]]):T(t)}}}function T(t){t.dataset.value&&(t.dataset.value=""),t.firstChild.data=t.dataset.placeholder||n.choose}function q(){!this.classList.contains("disabled")&&this.dataset.options&&L.call(this)}function L(t){var a=this;e.htmlDialog(m,"selectDialog",x,(function(){if(a!==k&&a?(r=(i=a).dataset,s=JSON.parse(r.options)):(i=void 0,s=(r=t).options),Array.isArray(s)){o=s,s={},f=0;for(var v=0;v<o.length;v++)s[o[v]]=o[v],r.value===o[v]&&(f=v)}else o=Object.keys(s),(f=o.indexOf(r.value))<0&&(f=0);if(l=o.length>8?9:o.length>6?7:o.length>4?5:o.length?3:0){if(g=(l-1)/2,c.style.height=l*C+2+"px",o.length<l){for(var p="",y=0;y<o.length;y++)p+="<div>".concat(s[o[y]],"</div>");c.innerHTML=p,0===f&&(c.firstChild.style.marginTop="32px")}else c.innerHTML=O(f);d.data=r.title||r.placeholder||n.choose,h.firstChild.data=r.ok||n.ok,u.firstChild.data=r.clear||n.clear,u.style.display=r.required||!r.value||1===o.length?"none":""}else e.closeDialog()}))}function x(t){var e;t&&("ok"===t&&r.value!==o[f]?(e=!0,r.value=o[f]):"clear"===t&&""!==r.value&&(e=!0,r.value=""),i?(e&&i.dispatchEvent(new Event("change")),i.dispatchEvent(new Event(t))):(e&&"function"==typeof r.onchange&&r.onchange({type:"change"}),"function"==typeof r["on"+t]&&r["on"+t]({type:t})))}function O(t,e){var a,n;e?(o.length>l?(n=t-g-1)<0&&(n+=o.length):n=(t+g)%o.length,a='<div style="margin-top:'.concat(e,'px">').concat(s[o[n]],"</div>")):a="";for(var i=t-g;i<=t+g;i++){var r=i%o.length;r<0&&(r+=o.length),a+="<div>".concat(s[o[r]],"</div>")}return a}}));